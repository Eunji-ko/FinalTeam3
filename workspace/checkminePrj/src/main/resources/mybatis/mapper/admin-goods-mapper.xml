<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="adminGoodsMapper">
	<select id="selectGoodsTotal" resultType="int">
		<choose>
		<when test='sort == "p"'>
			SELECT COUNT(*) FROM PUBLIC_PLACE
		</when>
		<otherwise>
			SELECT COUNT(*) FROM PUBLIC_GOODS
		</otherwise>
		</choose>
	</select>

	<select id="selectGoodsList" resultType="com.kh.checkmine.reservation.vo.GoodsVo">
			SELECT PG.*, NVL(CNT, 0) CNT FROM PUBLIC_GOODS PG
         LEFT OUTER JOIN (
         SELECT GOODS_NO, COUNT(NO) CNT FROM GOODS_RESERVATION 
         <![CDATA[WHERE TO_CHAR(BORROW,'YYYY-MM-DD') <= TO_CHAR(SYSDATE, 'YYYY-MM-DD') AND  TO_CHAR(RSV_END,'YYYY-MM-DD') >= TO_CHAR(SYSDATE, 'YYYY-MM-DD')]]>
             GROUP BY GOODS_NO
         ) GR ON PG.NO = GR.GOODS_NO WHERE PG.DELETE_YN = 'N'
         ORDER BY PG.NO
	</select>
	
	<select id="selectPlaceList" resultType="com.kh.checkmine.reservation.vo.PlaceVo">
			SELECT PP.*, NVL(CNT, 0) CNT FROM PUBLIC_PLACE PP
         LEFT OUTER JOIN (
         SELECT PL_NO, COUNT(NO) CNT FROM PLACE_RESERVATION
         <![CDATA[WHERE TO_CHAR(REV_BEGIN,'YYYY-MM-DD') <= TO_CHAR(SYSDATE, 'YYYY-MM-DD') AND  TO_CHAR(RSV_END,'YYYY-MM-DD') >= TO_CHAR(SYSDATE, 'YYYY-MM-DD')]]>
             GROUP BY pl_no
         ) PR ON PP.NO = PR.PL_NO WHERE PP.DELETE_YN = 'N'
         ORDER BY PP.NO
	</select>
	
	<select id="selectPlaceBook" resultType="com.kh.checkmine.reservation.vo.PlaceBookVo">
		SELECT P.NO, P.PL_NO, E.NAME EMP_NO, TO_CHAR(P.RSV_BEGIN, 'YYYY-MM-DD HH24:MI') RSV_BEGIN, TO_CHAR(P.RSV_END, 'YYYY-MM-DD HH24:MI') RSV_END, P.RSV_DATE FROM PLACE_RESERVATION P
		  JOIN EMPLOYEE E ON E.NO = P.EMP_NO
		  <![CDATA[WHERE TO_CHAR(REV_BEGIN,'YYYY-MM-DD') <= TO_CHAR(SYSDATE, 'YYYY-MM-DD') AND  TO_CHAR(RSV_END,'YYYY-MM-DD') >= TO_CHAR(SYSDATE, 'YYYY-MM-DD')]]>
		  AND PL_NO = #{no}
	
	</select>
	
	<select id="selectGoodsBook" resultType="com.kh.checkmine.reservation.vo.GoodsBookVo">
		 SELECT G.NO, E.NAME E_NO, G.GOODS_NO, TO_CHAR(G.BORROW, 'YYYY-MM-DD HH24:MI') BORROW, TO_CHAR(G.RSV_END, 'YYYY-MM-DD HH24:MI') RSV_END, G.RSV_DATE FROM GOODS_RESERVATION G
			  JOIN EMPLOYEE E ON E.NO = G.E_NO
			  <![CDATA[WHERE TO_CHAR(BORROW,'YYYY-MM-DD') <= TO_CHAR(SYSDATE, 'YYYY-MM-DD') AND  TO_CHAR(RSV_END,'YYYY-MM-DD') >= TO_CHAR(SYSDATE, 'YYYY-MM-DD')]]>
			  AND G.GOODS_NO = #{no}
	</select>
</mapper>